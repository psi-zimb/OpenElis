<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
   <changeSet author="buvaneswari" id="20">
      <comment>Create a new table to store types of result status - Change Request</comment>
      <createSequence sequenceName="type_of_result_status_seq" minValue="1" startValue="1" />
      <createTable schemaName="clinlims" tableName="type_of_result_status">
         <column name="id" type="int">
            <constraints primaryKeyName="pk_type_of_result_status" primaryKey="true" />
         </column>
         <column name="name" type="varchar(50)">
            <constraints nullable="false" />
         </column>
         <column name="description" type="varchar(200)">
            <constraints nullable="false" />
         </column>
         <column name="status_type" type="varchar(20)">
            <constraints nullable="false" />
         </column>
         <column name="is_active" type="boolean" defaultValueBoolean="true" />
         <column name="is_result_required" type="boolean" defaultValueBoolean="true" />
         <column name="is_approval_required" type="boolean" defaultValueBoolean="true" />
         <column name="date_created" type="timestamp" defaultValueDate="CURRENT_TIMESTAMP(6)" />
         <column name="lastupdated" type="timestamp(6)" />
      </createTable>
   </changeSet>
   <changeSet author="srivathsala20" id="20">
      <comment>create a new table to store type of test status</comment>
      <createSequence sequenceName="type_of_test_status_seq" minValue="1" startValue="1" />
      <createTable schemaName="clinlims" tableName="type_of_test_status">
         <column name="id" type="int">
            <constraints primaryKeyName="pk_type_of_test_status" primaryKey="true" />
         </column>
         <column name="status_name" type="varchar(50)">
            <constraints nullable="false" unique="true" />
         </column>
         <column name="description" type="varchar(200)">
            <constraints nullable="false" unique="true" />
         </column>
         <column name="status_type" type="varchar(20)">
            <constraints nullable="false" />
         </column>
         <column name="is_active" type="varchar(1)" defaultValue="Y" />
         <column name="is_result_required" type="varchar(1)" defaultValue="N" />
         <column name="is_approval_required" type="varchar(1)" defaultValue="N" />
         <column name="date_created" type="timestamp" defaultValueDate="CURRENT_TIMESTAMP(6)" />
         <column name="lastupdated" type="timestamp(6)" />
      </createTable>
   </changeSet>
   <changeSet author="srivathsala21" id="21">
      <comment>create a new table to store status for a test</comment>
      <createSequence sequenceName="test_status_seq" minValue="0" startValue="1" />
      <createTable schemaName="clinlims" tableName="test_status">
         <column name="id" type="int">
            <constraints primaryKeyName="pk_test_status" primaryKey="true" />
         </column>
         <column name="test_id" type="int">
            <constraints nullable="true" unique="true" />
         </column>
         <column name="test_status_id" type="int">
            <constraints nullable="true" />
         </column>
      </createTable>
   </changeSet>
   <changeSet id="srivathsala22" author="tw" context="bahmni">
      <addForeignKeyConstraint baseColumnNames="test_id" baseTableName="test_status" constraintName="test_fk" onDelete="SET NULL" referencedColumnNames="id" referencedTableName="test" />
   </changeSet>
   <changeSet id="srivathsala23" author="tw" context="bahmni">
      <addForeignKeyConstraint baseColumnNames="test_status_id" baseTableName="test_status" constraintName="test_status_fk" onDelete="SET NULL" referencedColumnNames="id" referencedTableName="type_of_test_status" />
   </changeSet>
</databaseChangeLog>
